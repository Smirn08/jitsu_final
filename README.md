### Заключительный проект курса  [Airflow101](https://github.com/python-jitsu/airflow101)
---
## о DAG

Airflow DAG представляет собой таски

забор URLs из гугл таблицы -> парсер просмотров -> загрузка количества просмотров в гугл таблицу -> сообщение в telegram о статистике

---
## Время работы
Ежедневно в 01:00 (UTC). Обновление по количеству просмотров каждые 48 часов, либо при изменении или добавлении информации в гугл таблицу
___
## Статусы сообщений в ячейках

- **BAD DOMAIN** - Не поддерживаюшийся парсингом домен
- **BAD URL** - Ссылка не валидная или по ссылке нет материала, откуда считать просмотры
- **NO VIEWS** - Валидная ссылка, но на странице нет элемента, отображающего количество просмотров, либо открывается общая страница с несколькими материалами
- **PARSER ERROR** - ошибка парсера
- **BROKEN VIDEO** - видео удалено, либо не доступно из региона

---
## Пример сообщений в телеграмм
![](https://sun9-67.userapi.com/c853424/v853424477/2440c2/xuH_0qtE9LE.jpg)

> - Количество URL в гугл таблице
> - Обновленных URL в бд
> - Количество строк в гугл таблице, которые не имеют количества просмотров, а > отображается один из статусов
> - Файл с детализацией ошибок

Сообщение динамическое, если нет обновления в гугл таблице, то выводится сообщение о том, что DAG отработал и об количестве URL в гугл таблице

---
## Запуск тестов
```
$ cd jitsu_final
$ pytest tests.py
```